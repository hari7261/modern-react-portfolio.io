import{_ as Y}from"./@babel-98964cd2.js";import{r as m}from"./react-199ba542.js";import{L as Me,T as xt,R as jt,U as Ot,a as Rt,O as ze,P as Ie,S as Ue,b as Ee,B as Tt,M as kt,C as At,V,c as nt,W as Dt,d as Ft,e as zt,f as It,g as Lt,N as Ht,A as Wt,h as $t,i as Bt,D as Nt,j as ge,k as Ut,l as qt,m as se,n as Vt,o as Gt,p as Xt}from"./three-82afda36.js";import{u as Yt}from"./react-use-measure-56148341.js";import{F as Zt,u as Kt}from"./its-fine-9ef78fdf.js";import{R as Jt,c as ie}from"./react-reconciler-4cf4b2a1.js";import{c as Qt}from"./react-dom-a3de5cd7.js";import{c as rt}from"./zustand-61210a00.js";var Un=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Vn(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var o=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};o.prototype=t.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(o,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}),o}var ot={exports:{}},it={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(b,E){var P=b.length;b.push(E);e:for(;0<P;){var j=P-1>>>1,x=b[j];if(0<s(x,E))b[j]=E,b[P]=x,P=j;else break e}}function o(b){return b.length===0?null:b[0]}function i(b){if(b.length===0)return null;var E=b[0],P=b.pop();if(P!==E){b[0]=P;e:for(var j=0,x=b.length,W=x>>>1;j<W;){var A=2*(j+1)-1,q=b[A],B=A+1,ee=b[B];if(0>s(q,P))B<x&&0>s(ee,q)?(b[j]=ee,b[B]=P,j=B):(b[j]=q,b[A]=P,j=A);else if(B<x&&0>s(ee,P))b[j]=ee,b[B]=P,j=B;else break e}}return E}function s(b,E){var P=b.sortIndex-E.sortIndex;return P!==0?P:b.id-E.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;e.unstable_now=function(){return u.now()}}else{var g=Date,h=g.now();e.unstable_now=function(){return g.now()-h}}var a=[],v=[],n=1,r=null,c=3,d=!1,p=!1,M=!1,y=typeof setTimeout=="function"?setTimeout:null,l=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(b){for(var E=o(v);E!==null;){if(E.callback===null)i(v);else if(E.startTime<=b)i(v),E.sortIndex=E.expirationTime,t(a,E);else break;E=o(v)}}function S(b){if(M=!1,_(b),!p)if(o(a)!==null)p=!0,U(O);else{var E=o(v);E!==null&&z(S,E.startTime-b)}}function O(b,E){p=!1,M&&(M=!1,l(F),F=-1),d=!0;var P=c;try{for(_(E),r=o(a);r!==null&&(!(r.expirationTime>E)||b&&!w());){var j=r.callback;if(typeof j=="function"){r.callback=null,c=r.priorityLevel;var x=j(r.expirationTime<=E);E=e.unstable_now(),typeof x=="function"?r.callback=x:r===o(a)&&i(a),_(E)}else i(a);r=o(a)}if(r!==null)var W=!0;else{var A=o(v);A!==null&&z(S,A.startTime-E),W=!1}return W}finally{r=null,c=P,d=!1}}var C=!1,D=null,F=-1,R=5,k=-1;function w(){return!(e.unstable_now()-k<R)}function T(){if(D!==null){var b=e.unstable_now();k=b;var E=!0;try{E=D(!0,b)}finally{E?$():(C=!1,D=null)}}else C=!1}var $;if(typeof f=="function")$=function(){f(T)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,H=G.port2;G.port1.onmessage=T,$=function(){H.postMessage(null)}}else $=function(){y(T,0)};function U(b){D=b,C||(C=!0,$())}function z(b,E){F=y(function(){b(e.unstable_now())},E)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(b){b.callback=null},e.unstable_continueExecution=function(){p||d||(p=!0,U(O))},e.unstable_forceFrameRate=function(b){0>b||125<b?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<b?Math.floor(1e3/b):5},e.unstable_getCurrentPriorityLevel=function(){return c},e.unstable_getFirstCallbackNode=function(){return o(a)},e.unstable_next=function(b){switch(c){case 1:case 2:case 3:var E=3;break;default:E=c}var P=c;c=E;try{return b()}finally{c=P}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(b,E){switch(b){case 1:case 2:case 3:case 4:case 5:break;default:b=3}var P=c;c=b;try{return E()}finally{c=P}},e.unstable_scheduleCallback=function(b,E,P){var j=e.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?j+P:j):P=j,b){case 1:var x=-1;break;case 2:x=250;break;case 5:x=1073741823;break;case 4:x=1e4;break;default:x=5e3}return x=P+x,b={id:n++,callback:E,priorityLevel:b,startTime:P,expirationTime:x,sortIndex:-1},P>j?(b.sortIndex=P,t(v,b),o(a)===null&&b===o(v)&&(M?(l(F),F=-1):M=!0,z(S,P-j))):(b.sortIndex=x,t(a,b),p||d||(p=!0,U(O))),b},e.unstable_shouldYield=w,e.unstable_wrapCallback=function(b){var E=c;return function(){var P=c;c=E;try{return b.apply(this,arguments)}finally{c=P}}}})(it);ot.exports=it;var qe=ot.exports;const Le={},en=e=>void Object.assign(Le,e);function tn(e,t){function o(n,{args:r=[],attach:c,...d},p){let M=`${n[0].toUpperCase()}${n.slice(1)}`,y;if(n==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=d.object;y=re(l,{type:n,root:p,attach:c,primitive:!0})}else{const l=Le[M];if(!l)throw new Error(`R3F: ${M} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");y=re(new l(...r),{type:n,root:p,attach:c,memoizedProps:{args:r}})}return y.__r3f.attach===void 0&&(y instanceof Tt?y.__r3f.attach="geometry":y instanceof kt&&(y.__r3f.attach="material")),M!=="inject"&&Se(y,d),y}function i(n,r){let c=!1;if(r){var d,p;(d=r.__r3f)!=null&&d.attach?Ce(n,r,r.__r3f.attach):r.isObject3D&&n.isObject3D&&(n.add(r),c=!0),c||(p=n.__r3f)==null||p.objects.push(r),r.__r3f||re(r,{}),r.__r3f.parent=n,De(r),oe(r)}}function s(n,r,c){let d=!1;if(r){var p,M;if((p=r.__r3f)!=null&&p.attach)Ce(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){r.parent=n,r.dispatchEvent({type:"added"});const y=n.children.filter(f=>f!==r),l=y.indexOf(c);n.children=[...y.slice(0,l),r,...y.slice(l)],d=!0}d||(M=n.__r3f)==null||M.objects.push(r),r.__r3f||re(r,{}),r.__r3f.parent=n,De(r),oe(r)}}function u(n,r,c=!1){n&&[...n].forEach(d=>g(r,d,c))}function g(n,r,c){if(r){var d,p,M;if(r.__r3f&&(r.__r3f.parent=null),(d=n.__r3f)!=null&&d.objects&&(n.__r3f.objects=n.__r3f.objects.filter(S=>S!==r)),(p=r.__r3f)!=null&&p.attach)Ze(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){var y;n.remove(r),(y=r.__r3f)!=null&&y.root&&cn(r.__r3f.root,r)}const f=(M=r.__r3f)==null?void 0:M.primitive,_=c===void 0?r.dispose!==null&&!f:c;if(!f){var l;u((l=r.__r3f)==null?void 0:l.objects,r,_),u(r.children,r,_)}r.__r3f&&(delete r.__r3f.root,delete r.__r3f.objects,delete r.__r3f.handlers,delete r.__r3f.memoizedProps,f||delete r.__r3f),_&&r.dispose&&r.type!=="Scene"&&qe.unstable_scheduleCallback(qe.unstable_IdlePriority,()=>{try{r.dispose()}catch{}}),oe(n)}}function h(n,r,c,d){var p;const M=(p=n.__r3f)==null?void 0:p.parent;if(!M)return;const y=o(r,c,n.__r3f.root);if(n.children){for(const l of n.children)l.__r3f&&i(y,l);n.children=n.children.filter(l=>!l.__r3f)}n.__r3f.objects.forEach(l=>i(y,l)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||g(M,n),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),i(M,y),y.raycast&&y.__r3f.eventCount&&y.__r3f.root.getState().internal.interaction.push(y),[d,d.alternate].forEach(l=>{l!==null&&(l.stateNode=y,l.ref&&(typeof l.ref=="function"?l.ref(y):l.ref.current=y))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Jt({createInstance:o,removeChild:g,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,r)=>{if(!r)return;const c=n.getState().scene;c.__r3f&&(c.__r3f.root=n,i(c,r))},removeChildFromContainer:(n,r)=>{r&&g(n.getState().scene,r)},insertInContainerBefore:(n,r,c)=>{if(!r||!c)return;const d=n.getState().scene;d.__r3f&&s(d,r,c)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var r;return!!((r=n==null?void 0:n.__r3f)!=null?r:{}).handlers},prepareUpdate(n,r,c,d){if(n.__r3f.primitive&&d.object&&d.object!==n)return[!0];{const{args:p=[],children:M,...y}=d,{args:l=[],children:f,..._}=c;if(!Array.isArray(p))throw new Error("R3F: the args prop must be an array!");if(p.some((O,C)=>O!==l[C]))return[!0];const S=dt(n,y,_,!0);return S.changes.length?[!1,S]:null}},commitUpdate(n,[r,c],d,p,M,y){r?h(n,d,M,y):Se(n,c)},commitMount(n,r,c,d){var p;const M=(p=n.__r3f)!=null?p:{};n.raycast&&M.handlers&&M.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>re(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var r;const{attach:c,parent:d}=(r=n.__r3f)!=null?r:{};c&&d&&Ze(d,n,c),n.isObject3D&&(n.visible=!1),oe(n)},unhideInstance(n,r){var c;const{attach:d,parent:p}=(c=n.__r3f)!=null?c:{};d&&p&&Ce(p,n,d),(n.isObject3D&&r.visible==null||r.visible)&&(n.visible=!0),oe(n)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>t?t():ie.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&L.fun(performance.now)?performance.now:L.fun(Date.now)?Date.now:()=>0,scheduleTimeout:L.fun(setTimeout)?setTimeout:void 0,cancelTimeout:L.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Se}}var Ve,Ge;const st=()=>{var e;return(e=Le.ColorManagement)!=null?e:null},at=e=>e&&e.isOrthographicCamera,nn=e=>e&&e.hasOwnProperty("current"),me=typeof window<"u"&&((Ve=window.document)!=null&&Ve.createElement||((Ge=window.navigator)==null?void 0:Ge.product)==="ReactNative")?m.useLayoutEffect:m.useEffect;function lt(e){const t=m.useRef(e);return me(()=>void(t.current=e),[e]),t}function rn({set:e}){return me(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ct extends m.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}ct.getDerivedStateFromError=()=>({error:!0});const ut="__default",Xe=new Map,on=e=>e&&!!e.memoized&&!!e.changes;function ft(e){const t=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(e)?Math.min(Math.max(e[0],t),e[1]):e}const ce=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},L={obj:e=>e===Object(e)&&!L.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(L.str(e)||L.num(e))return e===t;const u=L.obj(e);if(u&&i==="reference")return e===t;const g=L.arr(e);if(g&&o==="reference")return e===t;if((g||u)&&e===t)return!0;let h;for(h in e)if(!(h in t))return!1;if(u&&o==="shallow"&&i==="shallow"){for(h in s?t:e)if(!L.equ(e[h],t[h],{strict:s,objects:"reference"}))return!1}else for(h in s?t:e)if(e[h]!==t[h])return!1;if(L.und(h)){if(g&&e.length===0&&t.length===0||u&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function sn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function re(e,t){const o=e;return(t!=null&&t.primitive||!o.__r3f)&&(o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function Ae(e,t){let o=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return o=i.reduce((u,g)=>u[g],e),{target:o,key:s}}else return{target:o,key:t}}const Ye=/-\d+$/;function Ce(e,t,o){if(L.str(o)){if(Ye.test(o)){const u=o.replace(Ye,""),{target:g,key:h}=Ae(e,u);Array.isArray(g[h])||(g[h]=[])}const{target:i,key:s}=Ae(e,o);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=o(e,t)}function Ze(e,t,o){var i,s;if(L.str(o)){const{target:u,key:g}=Ae(e,o),h=t.__r3f.previousAttach;h===void 0?delete u[g]:u[g]=h}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function dt(e,{children:t,key:o,ref:i,...s},{children:u,key:g,ref:h,...a}={},v=!1){var n;const r=(n=e==null?void 0:e.__r3f)!=null?n:{},c=Object.entries(s),d=[];if(v){const M=Object.keys(a);for(let y=0;y<M.length;y++)s.hasOwnProperty(M[y])||c.unshift([M[y],ut+"remove"])}c.forEach(([M,y])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&M==="object"||L.equ(y,a[M]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(M))return d.push([M,y,!0,[]]);let f=[];M.includes("-")&&(f=M.split("-")),d.push([M,y,!1,f]);for(const _ in s){const S=s[_];_.startsWith(`${M}-`)&&d.push([_,S,!1,_.split("-")])}});const p={...s};return r.memoizedProps&&r.memoizedProps.args&&(p.args=r.memoizedProps.args),r.memoizedProps&&r.memoizedProps.attach&&(p.attach=r.memoizedProps.attach),{memoized:p,changes:d}}function Se(e,t){var o,i,s;const u=(o=e.__r3f)!=null?o:{},g=u.root,h=(i=g==null||g.getState==null?void 0:g.getState())!=null?i:{},{memoized:a,changes:v}=on(t)?t:dt(e,t),n=u.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let c=0;c<v.length;c++){let[d,p,M,y]=v[c],l=e,f=l[d];if(y.length&&(f=y.reduce((_,S)=>_[S],e),!(f&&f.set))){const[_,...S]=y.reverse();l=S.reverse().reduce((O,C)=>O[C],e),d=_}if(p===ut+"remove")if(l.constructor){let _=Xe.get(l.constructor);_||(_=new l.constructor,Xe.set(l.constructor,_)),p=_[d]}else p=0;if(M)p?u.handlers[d]=p:delete u.handlers[d],u.eventCount=Object.keys(u.handlers).length;else if(f&&f.set&&(f.copy||f instanceof Me)){if(Array.isArray(p))f.fromArray?f.fromArray(p):f.set(...p);else if(f.copy&&p&&p.constructor&&f.constructor===p.constructor)f.copy(p);else if(p!==void 0){const _=f instanceof At;!_&&f.setScalar?f.setScalar(p):f instanceof Me&&p instanceof Me?f.mask=p.mask:f.set(p),!st()&&!h.linear&&_&&f.convertSRGBToLinear()}}else l[d]=p,!h.linear&&l[d]instanceof xt&&l[d].format===jt&&l[d].type===Ot&&(l[d].encoding=void 0);oe(e)}if(u.parent&&h.internal&&e.raycast&&n!==u.eventCount){const c=h.internal.interaction.indexOf(e);c>-1&&h.internal.interaction.splice(c,1),u.eventCount&&h.internal.interaction.push(e)}return!(v.length===1&&v[0][0]==="onUpdate")&&v.length&&(s=e.__r3f)!=null&&s.parent&&De(e),e}function oe(e){var t,o;const i=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function De(e){e.onUpdate==null||e.onUpdate(e)}function an(e,t){e.manual||(at(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ye(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function ln(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ie.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ie.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ie.ContinuousEventPriority;default:return ie.DefaultEventPriority}}function pt(e,t,o,i){const s=o.get(t);s&&(o.delete(t),o.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function cn(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==t),o.initialHits=o.initialHits.filter(i=>i!==t),o.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&o.hovered.delete(s)}),o.capturedMap.forEach((i,s)=>{pt(o.capturedMap,t,i,s)})}function un(e){function t(a){const{internal:v}=e.getState(),n=a.offsetX-v.initialClick[0],r=a.offsetY-v.initialClick[1];return Math.round(Math.sqrt(n*n+r*r))}function o(a){return a.filter(v=>["Move","Over","Enter","Out","Leave"].some(n=>{var r;return(r=v.__r3f)==null?void 0:r.handlers["onPointer"+n]}))}function i(a,v){const n=e.getState(),r=new Set,c=[],d=v?v(n.internal.interaction):n.internal.interaction;for(let l=0;l<d.length;l++){const f=ce(d[l]);f&&(f.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(a,n);function p(l){const f=ce(l);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var _;f.events.compute==null||f.events.compute(a,f,(_=f.previousRoot)==null?void 0:_.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(l,!0):[]}let M=d.flatMap(p).sort((l,f)=>{const _=ce(l.object),S=ce(f.object);return!_||!S?l.distance-f.distance:S.events.priority-_.events.priority||l.distance-f.distance}).filter(l=>{const f=ye(l);return r.has(f)?!1:(r.add(f),!0)});n.events.filter&&(M=n.events.filter(M,n));for(const l of M){let f=l.object;for(;f;){var y;(y=f.__r3f)!=null&&y.eventCount&&c.push({...l,eventObject:f}),f=f.parent}}if("pointerId"in a&&n.internal.capturedMap.has(a.pointerId))for(let l of n.internal.capturedMap.get(a.pointerId).values())r.has(ye(l.intersection))||c.push(l.intersection);return c}function s(a,v,n,r){const c=e.getState();if(a.length){const d={stopped:!1};for(const p of a){const M=ce(p.object)||c,{raycaster:y,pointer:l,camera:f,internal:_}=M,S=new V(l.x,l.y,0).unproject(f),O=k=>{var w,T;return(w=(T=_.capturedMap.get(k))==null?void 0:T.has(p.eventObject))!=null?w:!1},C=k=>{const w={intersection:p,target:v.target};_.capturedMap.has(k)?_.capturedMap.get(k).set(p.eventObject,w):_.capturedMap.set(k,new Map([[p.eventObject,w]])),v.target.setPointerCapture(k)},D=k=>{const w=_.capturedMap.get(k);w&&pt(_.capturedMap,p.eventObject,w,k)};let F={};for(let k in v){let w=v[k];typeof w!="function"&&(F[k]=w)}let R={...p,...F,pointer:l,intersections:a,stopped:d.stopped,delta:n,unprojectedPoint:S,ray:y.ray,camera:f,stopPropagation(){const k="pointerId"in v&&_.capturedMap.get(v.pointerId);if((!k||k.has(p.eventObject))&&(R.stopped=d.stopped=!0,_.hovered.size&&Array.from(_.hovered.values()).find(w=>w.eventObject===p.eventObject))){const w=a.slice(0,a.indexOf(p));u([...w,p])}},target:{hasPointerCapture:O,setPointerCapture:C,releasePointerCapture:D},currentTarget:{hasPointerCapture:O,setPointerCapture:C,releasePointerCapture:D},nativeEvent:v};if(r(R),d.stopped===!0)break}}return a}function u(a){const{internal:v}=e.getState();for(const n of v.hovered.values())if(!a.length||!a.find(r=>r.object===n.object&&r.index===n.index&&r.instanceId===n.instanceId)){const c=n.eventObject.__r3f,d=c==null?void 0:c.handlers;if(v.hovered.delete(ye(n)),c!=null&&c.eventCount){const p={...n,intersections:a};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function g(a,v){for(let n=0;n<v.length;n++){const r=v[n].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(a)}}function h(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>u([]);case"onLostPointerCapture":return v=>{const{internal:n}=e.getState();"pointerId"in v&&n.capturedMap.has(v.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(v.pointerId)&&(n.capturedMap.delete(v.pointerId),u([]))})}}return function(n){const{onPointerMissed:r,internal:c}=e.getState();c.lastEvent.current=n;const d=a==="onPointerMove",p=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",y=i(n,d?o:void 0),l=p?t(n):0;a==="onPointerDown"&&(c.initialClick=[n.offsetX,n.offsetY],c.initialHits=y.map(_=>_.eventObject)),p&&!y.length&&l<=2&&(g(n,c.interaction),r&&r(n)),d&&u(y);function f(_){const S=_.eventObject,O=S.__r3f,C=O==null?void 0:O.handlers;if(O!=null&&O.eventCount)if(d){if(C.onPointerOver||C.onPointerEnter||C.onPointerOut||C.onPointerLeave){const D=ye(_),F=c.hovered.get(D);F?F.stopped&&_.stopPropagation():(c.hovered.set(D,_),C.onPointerOver==null||C.onPointerOver(_),C.onPointerEnter==null||C.onPointerEnter(_))}C.onPointerMove==null||C.onPointerMove(_)}else{const D=C[a];D?(!p||c.initialHits.includes(S))&&(g(n,c.interaction.filter(F=>!c.initialHits.includes(F))),D(_)):p&&c.initialHits.includes(S)&&g(n,c.interaction.filter(F=>!c.initialHits.includes(F)))}}s(y,n,l,f)}}return{handlePointer:h}}const mt=e=>!!(e!=null&&e.render),vt=m.createContext(null),fn=(e,t)=>{const o=rt((h,a)=>{const v=new V,n=new V,r=new V;function c(l=a().camera,f=n,_=a().size){const{width:S,height:O,top:C,left:D}=_,F=S/O;f instanceof V?r.copy(f):r.set(...f);const R=l.getWorldPosition(v).distanceTo(r);if(at(l))return{width:S/l.zoom,height:O/l.zoom,top:C,left:D,factor:1,distance:R,aspect:F};{const k=l.fov*Math.PI/180,w=2*Math.tan(k/2)*R,T=w*(S/O);return{width:T,height:w,top:C,left:D,factor:S/T,distance:R,aspect:F}}}let d;const p=l=>h(f=>({performance:{...f.performance,current:l}})),M=new nt;return{set:h,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(l=1)=>e(a(),l),advance:(l,f)=>t(l,f,a()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new $t,pointer:M,mouse:M,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=a();d&&clearTimeout(d),l.performance.current!==l.performance.min&&p(l.performance.min),d=setTimeout(()=>p(a().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:l=>h(f=>({...f,events:{...f.events,...l}})),setSize:(l,f,_,S,O)=>{const C=a().camera,D={width:l,height:f,top:S||0,left:O||0,updateStyle:_};h(F=>({size:D,viewport:{...F.viewport,...c(C,n,D)}}))},setDpr:l=>h(f=>{const _=ft(l);return{viewport:{...f.viewport,dpr:_,initialDpr:f.viewport.initialDpr||_}}}),setFrameloop:(l="always")=>{const f=a().clock;f.stop(),f.elapsedTime=0,l!=="never"&&(f.start(),f.elapsedTime=0),h(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:m.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,f,_)=>{const S=a().internal;return S.priority=S.priority+(f>0?1:0),S.subscribers.push({ref:l,priority:f,store:_}),S.subscribers=S.subscribers.sort((O,C)=>O.priority-C.priority),()=>{const O=a().internal;O!=null&&O.subscribers&&(O.priority=O.priority-(f>0?1:0),O.subscribers=O.subscribers.filter(C=>C.ref!==l))}}}}}),i=o.getState();let s=i.size,u=i.viewport.dpr,g=i.camera;return o.subscribe(()=>{const{camera:h,size:a,viewport:v,gl:n,set:r}=o.getState();if(a!==s||v.dpr!==u){var c;s=a,u=v.dpr,an(h,a),n.setPixelRatio(v.dpr);const d=(c=a.updateStyle)!=null?c:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(a.width,a.height,d)}h!==g&&(g=h,r(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(h)}})))}),o.subscribe(h=>e(h)),o};let be,dn=new Set,pn=new Set,mn=new Set;function xe(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function ue(e,t){switch(e){case"before":return xe(dn,t);case"after":return xe(pn,t);case"tail":return xe(mn,t)}}let je,Oe;function Re(e,t,o){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),je=t.internal.subscribers,be=0;be<je.length;be++)Oe=je[be],Oe.ref.current(Oe.store.getState(),i,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function vn(e){let t=!1,o,i,s;function u(a){i=requestAnimationFrame(u),t=!0,o=0,ue("before",a);for(const n of e.values()){var v;s=n.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((v=s.gl.xr)!=null&&v.isPresenting)&&(o+=Re(a,s))}if(ue("after",a),o===0)return ue("tail",a),t=!1,cancelAnimationFrame(i)}function g(a,v=1){var n;if(!a)return e.forEach(r=>g(r.store.getState()),v);(n=a.gl.xr)!=null&&n.isPresenting||!a.internal.active||a.frameloop==="never"||(a.internal.frames=Math.min(60,a.internal.frames+v),t||(t=!0,requestAnimationFrame(u)))}function h(a,v=!0,n,r){if(v&&ue("before",a),n)Re(a,n,r);else for(const c of e.values())Re(a,c.store.getState());v&&ue("after",a)}return{loop:u,invalidate:g,advance:h}}function ht(){const e=m.useContext(vt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function _e(e=o=>o,t){return ht()(e,t)}function He(e,t=0){const o=ht(),i=o.getState().internal.subscribe,s=lt(e);return me(()=>i(s,t,o),[t,i,o]),null}const ae=new Map,{invalidate:Ke,advance:Je}=vn(ae),{reconciler:we,applyProps:fe}=tn(ae,ln),ne={objects:"shallow",strict:!1},hn=(e,t)=>{const o=typeof e=="function"?e(t):e;return mt(o)?o:new Dt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function gn(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:o,height:i,top:s,left:u}=e.parentElement.getBoundingClientRect();return{width:o,height:i,top:s,left:u}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function yn(e){const t=ae.get(e),o=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,u=i||fn(Ke,Je),g=o||we.createContainer(u,ie.ConcurrentRoot,null,!1,null,"",s,null);t||ae.set(e,{fiber:g,store:u});let h,a=!1,v;return{configure(n={}){let{gl:r,size:c,scene:d,events:p,onCreated:M,shadows:y=!1,linear:l=!1,flat:f=!1,legacy:_=!1,orthographic:S=!1,frameloop:O="always",dpr:C=[1,2],performance:D,raycaster:F,camera:R,onPointerMissed:k}=n,w=u.getState(),T=w.gl;w.gl||w.set({gl:T=hn(r,e)});let $=w.raycaster;$||w.set({raycaster:$=new Rt});const{params:G,...H}=F||{};if(L.equ(H,$,ne)||fe($,{...H}),L.equ(G,$.params,ne)||fe($,{params:{...$.params,...G}}),!w.camera||w.camera===v&&!L.equ(v,R,ne)){v=R;const j=R instanceof Ft,x=j?R:S?new ze(0,0,0,0,.1,1e3):new Ie(75,0,.1,1e3);j||(x.position.z=5,R&&fe(x,R),!w.camera&&!(R!=null&&R.rotation)&&x.lookAt(0,0,0)),w.set({camera:x})}if(!w.scene){let j;d instanceof Ue?j=d:(j=new Ue,d&&fe(j,d)),w.set({scene:re(j)})}if(!w.xr){const j=(A,q)=>{const B=u.getState();B.frameloop!=="never"&&Je(A,!0,B,q)},x=()=>{const A=u.getState();A.gl.xr.enabled=A.gl.xr.isPresenting,A.gl.xr.setAnimationLoop(A.gl.xr.isPresenting?j:null),A.gl.xr.isPresenting||Ke(A)},W={connect(){const A=u.getState().gl;A.xr.addEventListener("sessionstart",x),A.xr.addEventListener("sessionend",x)},disconnect(){const A=u.getState().gl;A.xr.removeEventListener("sessionstart",x),A.xr.removeEventListener("sessionend",x)}};T.xr&&W.connect(),w.set({xr:W})}if(T.shadowMap){const j=T.shadowMap.enabled,x=T.shadowMap.type;if(T.shadowMap.enabled=!!y,L.boo(y))T.shadowMap.type=Ee;else if(L.str(y)){var U;const W={basic:zt,percentage:It,soft:Ee,variance:Lt};T.shadowMap.type=(U=W[y])!=null?U:Ee}else L.obj(y)&&Object.assign(T.shadowMap,y);(j!==T.shadowMap.enabled||x!==T.shadowMap.type)&&(T.shadowMap.needsUpdate=!0)}const z=st();z&&("enabled"in z?z.enabled=!_:"legacyMode"in z&&(z.legacyMode=_));const b=void 0,E=f?Ht:Wt;T.outputEncoding!==b&&(T.outputEncoding=b),T.toneMapping!==E&&(T.toneMapping=E),w.legacy!==_&&w.set(()=>({legacy:_})),w.linear!==l&&w.set(()=>({linear:l})),w.flat!==f&&w.set(()=>({flat:f})),r&&!L.fun(r)&&!mt(r)&&!L.equ(r,T,ne)&&fe(T,r),p&&!w.events.handlers&&w.set({events:p(u)});const P=gn(e,c);return L.equ(P,w.size,ne)||w.setSize(P.width,P.height,P.updateStyle,P.top,P.left),C&&w.viewport.dpr!==ft(C)&&w.setDpr(C),w.frameloop!==O&&w.setFrameloop(O),w.onPointerMissed||w.set({onPointerMissed:k}),D&&!L.equ(D,w.performance,ne)&&w.set(j=>({performance:{...j.performance,...D}})),h=M,a=!0,this},render(n){return a||this.configure(),we.updateContainer(m.createElement(bn,{store:u,children:n,onCreated:h,rootElement:e}),g,null,()=>{}),u},unmount(){gt(e)}}}function bn({store:e,children:t,onCreated:o,rootElement:i}){return me(()=>{const s=e.getState();s.set(u=>({internal:{...u.internal,active:!0}})),o&&o(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),m.createElement(vt.Provider,{value:e},t)}function gt(e,t){const o=ae.get(e),i=o==null?void 0:o.fiber;if(i){const s=o==null?void 0:o.store.getState();s&&(s.internal.active=!1),we.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var u,g,h,a;s.events.disconnect==null||s.events.disconnect(),(u=s.gl)==null||(g=u.renderLists)==null||g.dispose==null||g.dispose(),(h=s.gl)==null||h.forceContextLoss==null||h.forceContextLoss(),(a=s.gl)!=null&&a.xr&&s.xr.disconnect(),sn(s),ae.delete(e),t&&t(e)}catch{}},500)})}}we.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:m.version});const Te={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function _n(e){const{handlePointer:t}=un(e);return{priority:1,enabled:!0,compute(o,i,s){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Te).reduce((o,i)=>({...o,[i]:t(i)}),{}),update:()=>{var o;const{events:i,internal:s}=e.getState();(o=s.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:o=>{var i;const{set:s,events:u}=e.getState();u.disconnect==null||u.disconnect(),s(g=>({events:{...g.events,connected:o}})),Object.entries((i=u.handlers)!=null?i:[]).forEach(([g,h])=>{const[a,v]=Te[g];o.addEventListener(a,h,{passive:v})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([u,g])=>{if(i&&i.connected instanceof HTMLElement){const[h]=Te[u];i.connected.removeEventListener(h,g)}}),o(u=>({events:{...u.events,connected:void 0}}))}}}}const wn=m.forwardRef(function({children:t,fallback:o,resize:i,style:s,gl:u,events:g=_n,eventSource:h,eventPrefix:a,shadows:v,linear:n,flat:r,legacy:c,orthographic:d,frameloop:p,dpr:M,performance:y,raycaster:l,camera:f,onPointerMissed:_,onCreated:S,...O},C){m.useMemo(()=>en(Bt),[]);const D=Kt(),[F,R]=Yt({scroll:!0,debounce:{scroll:50,resize:0},...i}),k=m.useRef(null),w=m.useRef(null);m.useImperativeHandle(C,()=>k.current);const T=lt(_),[$,G]=m.useState(!1),[H,U]=m.useState(!1);if($)throw $;if(H)throw H;const z=m.useRef(null);me(()=>{const E=k.current;R.width>0&&R.height>0&&E&&(z.current||(z.current=yn(E)),z.current.configure({gl:u,events:g,shadows:v,linear:n,flat:r,legacy:c,orthographic:d,frameloop:p,dpr:M,performance:y,raycaster:l,camera:f,size:R,onPointerMissed:(...P)=>T.current==null?void 0:T.current(...P),onCreated:P=>{P.events.connect==null||P.events.connect(h?nn(h)?h.current:h:w.current),a&&P.setEvents({compute:(j,x)=>{const W=j[a+"X"],A=j[a+"Y"];x.pointer.set(W/x.size.width*2-1,-(A/x.size.height)*2+1),x.raycaster.setFromCamera(x.pointer,x.camera)}}),S==null||S(P)}}),z.current.render(m.createElement(D,null,m.createElement(ct,{set:U},m.createElement(m.Suspense,{fallback:m.createElement(rn,{set:G})},t)))))}),m.useEffect(()=>{const E=k.current;if(E)return()=>gt(E)},[]);const b=h?"none":"auto";return m.createElement("div",Y({ref:w,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:b,...s}},O),m.createElement("div",{ref:F,style:{width:"100%",height:"100%"}},m.createElement("canvas",{ref:k,style:{display:"block"}},o)))}),Gn=m.forwardRef(function(t,o){return m.createElement(Zt,null,m.createElement(wn,Y({},t,{ref:o})))}),ve=new V,We=new V,Pn=new V,Qe=new nt;function Mn(e,t,o){const i=ve.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=o.width/2,u=o.height/2;return[i.x*s+s,-(i.y*u)+u]}function En(e,t){const o=ve.setFromMatrixPosition(e.matrixWorld),i=We.setFromMatrixPosition(t.matrixWorld),s=o.sub(i),u=t.getWorldDirection(Pn);return s.angleTo(u)>Math.PI/2}function Cn(e,t,o,i){const s=ve.setFromMatrixPosition(e.matrixWorld),u=s.clone();u.project(t),Qe.set(u.x,u.y),o.setFromCamera(Qe,t);const g=o.intersectObjects(i,!0);if(g.length){const h=g[0].distance;return s.distanceTo(o.ray.origin)<h}return!0}function Sn(e,t){if(t instanceof ze)return t.zoom;if(t instanceof Ie){const o=ve.setFromMatrixPosition(e.matrixWorld),i=We.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,u=o.distanceTo(i);return 1/(2*Math.tan(s/2)*u)}else return 1}function xn(e,t,o){if(t instanceof Ie||t instanceof ze){const i=ve.setFromMatrixPosition(e.matrixWorld),s=We.setFromMatrixPosition(t.matrixWorld),u=i.distanceTo(s),g=(o[1]-o[0])/(t.far-t.near),h=o[1]-g*t.far;return Math.round(g*u+h)}}const Fe=e=>Math.abs(e)<1e-10?0:e;function yt(e,t,o=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=Fe(t[s]*e.elements[s])+(s!==15?",":")");return o+i}const jn=(e=>t=>yt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),On=(e=>(t,o)=>yt(t,e(o),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Rn(e){return e&&typeof e=="object"&&"current"in e}const Xn=m.forwardRef(({children:e,eps:t=.001,style:o,className:i,prepend:s,center:u,fullscreen:g,portal:h,distanceFactor:a,sprite:v=!1,transform:n=!1,occlude:r,onOcclude:c,castShadow:d,receiveShadow:p,material:M,geometry:y,zIndexRange:l=[16777271,0],calculatePosition:f=Mn,as:_="div",wrapperClass:S,pointerEvents:O="auto",...C},D)=>{const{gl:F,camera:R,scene:k,size:w,raycaster:T,events:$,viewport:G}=_e(),[H]=m.useState(()=>document.createElement(_)),U=m.useRef(),z=m.useRef(null),b=m.useRef(0),E=m.useRef([0,0]),P=m.useRef(null),j=m.useRef(null),x=(h==null?void 0:h.current)||$.connected||F.domElement.parentNode,W=m.useRef(null),A=m.useRef(!1),q=m.useMemo(()=>r&&r!=="blending"||Array.isArray(r)&&r.length&&Rn(r[0]),[r]);m.useLayoutEffect(()=>{const N=F.domElement;r&&r==="blending"?(N.style.zIndex=`${Math.floor(l[0]/2)}`,N.style.position="absolute",N.style.pointerEvents="none"):(N.style.zIndex=null,N.style.position=null,N.style.pointerEvents=null)},[r]),m.useLayoutEffect(()=>{if(z.current){const N=U.current=Qt(H);if(k.updateMatrixWorld(),n)H.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const I=f(z.current,R,w);H.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${I[0]}px,${I[1]}px,0);transform-origin:0 0;`}return x&&(s?x.prepend(H):x.appendChild(H)),()=>{x&&x.removeChild(H),N.unmount()}}},[x,n]),m.useLayoutEffect(()=>{S&&(H.className=S)},[S]);const B=m.useMemo(()=>n?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:u?"translate3d(-50%,-50%,0)":"none",...g&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...o},[o,u,g,w,n]),ee=m.useMemo(()=>({position:"absolute",pointerEvents:O}),[O]);m.useLayoutEffect(()=>{if(A.current=!1,n){var N;(N=U.current)==null||N.render(m.createElement("div",{ref:P,style:B},m.createElement("div",{ref:j,style:ee},m.createElement("div",{ref:D,className:i,style:o,children:e}))))}else{var I;(I=U.current)==null||I.render(m.createElement("div",{ref:D,style:B,className:i,children:e}))}});const te=m.useRef(!0);He(N=>{if(z.current){R.updateMatrixWorld(),z.current.updateWorldMatrix(!0,!1);const I=n?E.current:f(z.current,R,w);if(n||Math.abs(b.current-R.zoom)>t||Math.abs(E.current[0]-I[0])>t||Math.abs(E.current[1]-I[1])>t){const Z=En(z.current,R);let X=!1;q&&(Array.isArray(r)?X=r.map(K=>K.current):r!=="blending"&&(X=[k]));const le=te.current;if(X){const K=Cn(z.current,R,T,X);te.current=K&&!Z}else te.current=!Z;le!==te.current&&(c?c(!te.current):H.style.display=te.current?"block":"none");const he=Math.floor(l[0]/2),_t=r?q?[l[0],he]:[he-1,0]:l;if(H.style.zIndex=`${xn(z.current,R,_t)}`,n){const[K,Be]=[w.width/2,w.height/2],Pe=R.projectionMatrix.elements[5]*Be,{isOrthographicCamera:Ne,top:wt,left:Pt,bottom:Mt,right:Et}=R,Ct=jn(R.matrixWorldInverse),St=Ne?`scale(${Pe})translate(${Fe(-(Et+Pt)/2)}px,${Fe((wt+Mt)/2)}px)`:`translateZ(${Pe}px)`;let J=z.current.matrixWorld;v&&(J=R.matrixWorldInverse.clone().transpose().copyPosition(J).scale(z.current.scale),J.elements[3]=J.elements[7]=J.elements[11]=0,J.elements[15]=1),H.style.width=w.width+"px",H.style.height=w.height+"px",H.style.perspective=Ne?"":`${Pe}px`,P.current&&j.current&&(P.current.style.transform=`${St}${Ct}translate(${K}px,${Be}px)`,j.current.style.transform=On(J,1/((a||10)/400)))}else{const K=a===void 0?1:Sn(z.current,R)*a;H.style.transform=`translate3d(${I[0]}px,${I[1]}px,0) scale(${K})`}E.current=I,b.current=R.zoom}}if(!q&&W.current&&!A.current)if(n){if(P.current){const I=P.current.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const{isOrthographicCamera:Z}=R;if(Z||y)C.scale&&(Array.isArray(C.scale)?C.scale instanceof V?W.current.scale.copy(C.scale.clone().divideScalar(1)):W.current.scale.set(1/C.scale[0],1/C.scale[1],1/C.scale[2]):W.current.scale.setScalar(1/C.scale));else{const X=(a||10)/400,le=I.clientWidth*X,he=I.clientHeight*X;W.current.scale.set(le,he,1)}A.current=!0}}}else{const I=H.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const Z=1/G.factor,X=I.clientWidth*Z,le=I.clientHeight*Z;W.current.scale.set(X,le,1),A.current=!0}W.current.lookAt(N.camera.position)}});const $e=m.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return m.createElement("group",Y({},C,{ref:z}),r&&!q&&m.createElement("mesh",{castShadow:d,receiveShadow:p,ref:W},y||m.createElement("planeGeometry",null),M||m.createElement("shaderMaterial",{side:Nt,vertexShader:$e.vertexShader,fragmentShader:$e.fragmentShader})))});let de=0;const Yn=rt(e=>(ge.onStart=(t,o,i)=>{e({active:!0,item:t,loaded:o,total:i,progress:(o-de)/(i-de)*100})},ge.onLoad=()=>{e({active:!1})},ge.onError=t=>e(o=>({errors:[...o.errors,t]})),ge.onProgress=(t,o,i)=>{o===i&&(de=i),e({active:!0,item:t,loaded:o,total:i,progress:(o-de)/(i-de)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Tn=()=>parseInt(Ut.replace(/\D+/g,"")),bt=Tn(),ke=bt>=154?"opaque_fragment":"output_fragment";class kn extends qt{constructor(t){super(t),this.onBeforeCompile=(o,i)=>{const{isWebGL2:s}=i.capabilities;o.fragmentShader=o.fragmentShader.replace(`#include <${ke}>`,`
        ${s?`#include <${ke}>`:`#extension GL_OES_standard_derivatives : enable
#include <${ke}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${bt>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const Zn=m.forwardRef((e,t)=>{const[o]=m.useState(()=>new kn(null));return m.createElement("primitive",Y({},e,{object:o,ref:t,attach:"material"}))});let Q,pe;const An=m.createContext(null),et=new Vt,tt=new V,Dn=m.forwardRef(({children:e,range:t,limit:o=1e3,...i},s)=>{const u=m.useRef(null);m.useImperativeHandle(s,()=>u.current,[]);const[g,h]=m.useState([]),[[a,v,n]]=m.useState(()=>[new Float32Array(o*3),Float32Array.from({length:o*3},()=>1),Float32Array.from({length:o},()=>1)]);m.useEffect(()=>{u.current.geometry.attributes.position.needsUpdate=!0}),He(()=>{for(u.current.updateMatrix(),u.current.updateMatrixWorld(),et.copy(u.current.matrixWorld).invert(),u.current.geometry.drawRange.count=Math.min(o,t!==void 0?t:o,g.length),Q=0;Q<g.length;Q++)pe=g[Q].current,pe.getWorldPosition(tt).applyMatrix4(et),tt.toArray(a,Q*3),u.current.geometry.attributes.position.needsUpdate=!0,pe.matrixWorldNeedsUpdate=!0,pe.color.toArray(v,Q*3),u.current.geometry.attributes.color.needsUpdate=!0,n.set([pe.size],Q),u.current.geometry.attributes.size.needsUpdate=!0});const r=m.useMemo(()=>({getParent:()=>u,subscribe:c=>(h(d=>[...d,c]),()=>h(d=>d.filter(p=>p.current!==c.current)))}),[]);return m.createElement("points",Y({userData:{instances:g},matrixAutoUpdate:!1,ref:u,raycast:()=>null},i),m.createElement("bufferGeometry",null,m.createElement("bufferAttribute",{attach:"attributes-position",count:a.length/3,array:a,itemSize:3,usage:se}),m.createElement("bufferAttribute",{attach:"attributes-color",count:v.length/3,array:v,itemSize:3,usage:se}),m.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:se})),m.createElement(An.Provider,{value:r},e))}),Fn=m.forwardRef(({children:e,positions:t,colors:o,sizes:i,stride:s=3,...u},g)=>{const h=m.useRef(null);return m.useImperativeHandle(g,()=>h.current,[]),He(()=>{const a=h.current.geometry.attributes;a.position.needsUpdate=!0,o&&(a.color.needsUpdate=!0),i&&(a.size.needsUpdate=!0)}),m.createElement("points",Y({ref:h},u),m.createElement("bufferGeometry",null,m.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/s,array:t,itemSize:s,usage:se}),o&&m.createElement("bufferAttribute",{attach:"attributes-color",count:o.length/s,array:o,itemSize:3,usage:se}),i&&m.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/s,array:i,itemSize:1,usage:se})),e)}),Kn=m.forwardRef((e,t)=>e.positions instanceof Float32Array?m.createElement(Fn,Y({},e,{ref:t})):m.createElement(Dn,Y({},e,{ref:t})));function Jn({all:e,scene:t,camera:o}){const i=_e(({gl:g})=>g),s=_e(({camera:g})=>g),u=_e(({scene:g})=>g);return m.useLayoutEffect(()=>{const g=[];e&&(t||u).traverse(v=>{v.visible===!1&&(g.push(v),v.visible=!0)}),i.compile(t||u,o||s);const h=new Gt(128);new Xt(.01,1e5,h).update(i,t||u),h.dispose(),g.forEach(v=>v.visible=!1)},[]),null}export{Gn as C,Xn as H,Jn as P,Vn as a,He as b,Un as c,Kn as d,Zn as e,qn as g,Yn as u};
